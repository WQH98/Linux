###### 一、IIC协议详解

1、ALPHA开发板上有一个AP3216C，这是一个IIC接口的器件，这是一个环境光传感器。AP3216C连接到了IIC1上。
I2C1_SCL：使用UART4_TXD这个IO，复用为ALT2。
I2C1_SDA：使用UART4_RXD这个IO，复用为ALT2。

2、I2C分为SCL和SDA，这两个必须要接上拉电阻到VCC，比如3.3V，一般是4.7K上拉电阻。

3、I2C总线支持多从机， 通过从机地址来区分访问哪个从机。

###### 二、6ULL I2C接口详解

1、6ULL的I2C频率标准模式100KHz，快速模式400KHz。

2、时钟源选择perclk_clk_root = ipg_clk_root = 66MHz。

3、IFDR寄存器设置I2C频率，bit5~0设置分频值，假如我们现在需要100KHz的速率，那么66000000 /  100000 = 660，经过查找，IC位设置为0x38或0x15的时候，为640分频。那么速率就是66000000 / 640 ≈ 103.125KHz。

4、I2CR寄存器，bit7为I2C使能位，置1使能I2C，bit5为主从模式选择位，为0表示从机，为1表示主机，bit4为发送接收设置位，为0的时候是接收，为1的时候是发送。

5、I2SR寄存器，bit7为传输完成位，为0表示正在发送，为1表示发送完成，bit5为I2C忙闲位，为0的时候表示I2C总线空闲，为1的时候表示I2C总线忙，bit0是读确认位，也就是ACK信号。

6、I2DR寄存器，数据寄存器。

###### 三、AP3216C简介

1、AP316C是一个三合一的环境光传感器，ALS + PS + IRLED，ALS是环境光，PS是接近传感器，IRLED是红外LED灯。I2C接口最高400Kbit/S的速率。

2、环境光，ALS是16bit输出。

3、接近传感器PS，10bit输出。IR传感器也是10bit。

4、AP3216C的从机地址是0x01。

5、0x0A是IR Data low。bit7为0的时候表示IR和PS数据有效，为1的时候表示IR和PS数据无效，bit1~0是IR的低2位。

6、0x0B是IR Data high。bit7~0是高字节，与0x0A一起组成10bit的数据。

7、0x0C和0x0D分别是ALS的低8位和高8位。

8、0x0E是PS Data low。bit3~0是低4位数据，0x0F的bit5~0是高6位数据。加起来就是10bit数据。

9、0x00是系统配置寄存器，bit2~0设置AP3216C开启哪些传感器。我们需要设置为011，也就是0x03，也就是开启ALS + PS + IR。