###### 一、SPI协议详解

1、SPI相比I2C最大的优势有两点，一个是速度窥快，最高可达几十MHz，甚至上百MHz，第二个就是SPI是个全双工。

2、SPI接口和I2C一样，一个SPI接口可以连接多个SPI外设，SPI通过CS引脚/数据线，片选引脚来选择和哪个SPI外设通信。SPI通信前先将指定的SPI外设对应的CS引脚拉低来选中此设备。

3、ALPHA开发板上通过ECSPI3接口连接了一个6轴传感器，引脚如下：
		ECSPI3_SCLK：UART2_RXD。
		ECSPI3_MOSI：UART2_CTS。
		ECSPI3_MISO：UART2_RTS。
		ECSPI3_SS0：UART2_TXD。
6ULL一个SPI主接口有4个硬件片选，分别为SS0~SS3。

4、SPI有四种工作模式，通过串行时钟极性（CPOL）和相位（CPHA）的搭配来得到四种工作模式：
①、CPOL = 0，串行时钟空闲状态为低电平。
②、CPOL = 1，串行时钟空闲状态为高电平，此时可以通过配置时钟相位（CPHA）来选择具体的传输协议。
③、CPHA = 0，串行时钟的第一个跳变沿（上升沿或下降沿）采集数据。
④、CPHA = 1，串行时钟的第二个跳变沿（上升沿或下降沿）采集数据。
一般使用CPOL = 0，CPHA = 0。

###### 二、6ULL SPI 接口详解

1、6ULL的SPI接口叫做ECSPI，支持全双工，主从可配置。

2、4个硬件片选信号，可以使用软件片选，这样一个SPI接口所能连接的外设就无限制了。

3、RXDATA寄存器为接收到的数据。

4、TXDATA寄存器为发送数据寄存器。

5、CONREG寄存器为配置寄存器。bit0置1，使能SPI。bit3置1，表示当向TXFIFO写入数据以后马上开启SPI突发访问。bit7~4设置SPI通道主从模式，bit7为通道3，bit4为通道0，我们使用到了SS0，也就是通道0，因此需要设置bit4为1。bit19~18设置为00，我们使用到SS0，也就是通道0。bit31~20设置突发访问长度，设置为7，也就是8bit突发长度，等于1字节。

6、CONFIGREG寄存器的bit0为PHA，设置为0，表示串行时钟的第一个跳变沿开始采集数据。bit4设置为0，表示空闲时为低电平。bit8设置为0。bit12设置为0，表示片选信号低电平有效。bit16设置为0，表示空闲的时候数据线为高。bit12设置为0，表示SCLK空闲时候为低。

7、STATREG状态寄存器，bit0等待TXFIFO为空，我们在发送数据之前要等待TXFIFO为空，也就是等待bit0为1。bit3是RXFIFO是否有数据，为1的时候表示RXFIFO至少有一个字的数据（32位），我们在接收数据的时候，要等待bit3为1。

8、PERIODREG寄存器，bit14~0设置wait state的时间，我们设置为0x2000。bit15设置wait state的时钟源，置0为SPI CLK。bit21~16表示片选信号的延迟，可设置0~23，设置为0，不需要这个片选。

9、SPI时钟设置，SPI时钟源最终来源于PLL3_SW_CLK / 8 = 480MHz / 8 = 60MHz，设置CSCDR2寄存器的bit18为0，也就是ECSPI时钟源为60MHz。设置CSCDR2寄存器的bit24~19设置为0，表示1分频。因此最终进入到SPI外设的时钟源为60MHz。
ECSPI模块还需要对时钟进行两级分频，由ECSPI_CONREG寄存器设置，bit15~12设置前级分频，可以设置0x00~0x0F，表示1~16分频。bit11~8设置二级分频，设置2^n分频，n = 0~15。

###### 三、ICM20608简介

1、6轴传感器，3轴陀螺仪，3轴加速度计。

2、陀螺仪分别率可设置。加速度分辨率可设置。

3、陀螺仪和加速度都是16bit ADC。

4、通信接口为I2C或SPI，I2C最大到400KHz，SPI最大到8MHz。

5、ICM20608G的WHO_AM_I寄存器，地址为0x75，默认值为0xAF。ICM20608D的WHO_AM_I寄存器，地址为0x75，默认值为0xAE。

6、0x3B~0x48就是我们要读取的传感器数据。

###### 四、硬件浮点问题

1、我们在使用浮点计算的时候卡死了，因为我们没有开启6ULL的硬件浮点计算，我们在编译的时候没有使用浮点。解决问题需要两点：
①、开启6ULL的硬件浮点单元
②、编译的时候指定硬件浮点