#### 一、Linux阻塞和非阻塞IO

###### 1、阻塞与非阻塞简介

阻塞：当资源不可用的时候，应用程序就会挂起。当资源可用的时候，唤醒应用程序。应用程序使用open 打开驱动文件，默认是阻塞方式打开。
非阻塞：当资源不可用的时候，应用程序轮询查看货放弃。会有超时处理机制。应用程序在使用open打开驱动文件的时候，使用O_NONBLOCK标志非阻塞方式打开文件。

###### 2、等待队列

当驱动文件不可用的时候，应用程序会挂载在等待队列。

①、等待队列头，阻塞访问最大的好处就是当设备文件不可操作的时候进程可以进入休眠态，这样可以将CPU资源让出来。但是，当设备文件可以操作的时候就必须唤醒进程，一般在中断函数里完成唤醒工作。

②、等待队列项，等待队列头就是一个等待队列的头部，每个访问设备的进程都是一个队列项，当设备不可用的时候就要将这些进程对应的等待队列添加到等待队列里面。

③、添加队列项到等待队列头，当设备不可用的时候就需要将进程对应的等待队列项添加到前面创建的等待队列头中，只有添加到等待队列头中以后进程才能进入休眠态。

④、当资源可用的时候移除等待队列项。

⑤、当设备可以用的时候就要唤醒进入休眠态的进程。

⑥、除了主动唤醒以外，也可以设置等待队列等待某个事件，当这个事件满足以后就自动唤醒等待队列中的进程。

###### 3、轮询

如果用户应用程序以非阻塞的方式访问设备，设备驱动程序就要提供非阻塞的处理方式，也就是轮询。poll、epoll和select可以用于处理轮询，应用程序通过select、epoll或poll函数来查询设备是否可以操作，如果可以操作的话就从设备读取或者向设备写入数据。当应用程序调用select、epoll或poll函数的时候设备驱动程序中的poll函数就会执行，因此需要再设备驱动程序中编写poll函数。