###### 一、异步通知简介

1、硬件中断

中断是处理器提供的一种异步机制，我们配置好中断以后就可以让处理器去处理其他的事情了，当中断发生以后会触发我们事先设置好的中断服务函数，在中断服务函数中做具体的处理。

同样的，LInux应用程序可以通过阻塞或者非阻塞这两种方式来访问驱动设备，通过阻塞方式访问的话应用程序会处于休眠态，等待驱动设备可以使用，非阻塞方式的话会通过poll函数来不断的轮询，查看驱动设备文件是否可以使用。

2、信号

软件层次上的中断，也叫做软中断信号，软件层次上对中断机制的一种模拟。

信号类似于我们硬件上使用的中断，只不过信号时软件层次上的，算是在软件层次上对中断的一种模拟，驱动可以通过主动向应用程序发送信号的方式来报告自己可以访问了，应用程序获取到信号以后就可以从驱动设备中读取或者写入数据了。整个过程就相当于应用程序收到了驱动发送过来的一个中断，然后应用程序去响应这个中断，在整个处理过程中应用程序并没有去查询驱动设备是否可以访问，一切都是由驱动设备自己告诉给应用程序的。

3、信号处理函数

应用程序使用signal函数，设置信号处理函数，原型为：

```c
sighandler_t signal(int signum, sighandler_t handler);
```

信号处理函数为：

```c
typedef void(*sighandler_t)(int);
```

4、驱动中对异步通知的处理

需要实现file_operations中的faync函数，函数原型如下：

```c
int (*fsync)(struct file*, loff_t, loff_t, int datasync);
```

首先需要使用fasync_struct定义一个指针结构体变量。
实现file_operations里面的fasync函数。fasync函数还需要fasync_helper函数。
驱动里面调用kill_fasync向应用发送信号。
关闭驱动的时候删除信号。