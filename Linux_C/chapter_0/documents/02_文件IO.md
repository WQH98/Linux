##### 1、什么是文件I/O？

###### 文件I/O（input/output）

文件I/O指的是对文件的输入、输出操作，通俗点就是对文件的读/写操作。

##### 2、文件描述符

###### 什么是文件描述符？

文件句柄、一个非负整数、与对应的文件相绑定。

###### 文件描述符如何分配？

分配一个没有被使用的最小非负整数作为文件描述符。

###### 标准输入、标准输出和标准错误

0、1、2

##### 3、Linux系统下文件如何管理

静态文件在磁盘存储的最小单位是扇区（512字节=0.5K），计算机管理文件的单位是块（块=8个扇区=4K）

![image-20241105143529054](/home/wqh/Project/Linux/Linux_C/chapter_0/documents/02_文件IO.assets/文件描述符、文件表以及inode之间的关系.png)


##### 4、错误编号errno

errno变量是一个全局变量，需要包含errno.h文件，这个整形变量的作用是用来存储错误编号的，在Linux中，每一种错误类型都使用一个错误编号来表示。
strerror()函数，参数是错误编号，返回值是错误信息。
perror()函数，不需要调用printf，直接可以打印错误信息。

##### 5、空洞文件的概念

使用lseek函数跳过的空间称为空洞文件。
使用场景是在多线程下对文件的写操作。

##### 6、O_TRUNC和O_APPEND标志

O_TRUNC标志：截断文件、丢弃文件中的内容，文件大小变为0。
O_APPEND标志：保证每次调用write()时都是从文件末尾开始写入。
需要注意两个点：1、O_APPEND标志对read操作不会有影响。2、lseek操作不会影响write操作。

##### 7、同一文件被多次打开

文件描述符与文件的对应关系：n对1，使用任何一个fd都可对同一文件进行读写操作。
读写位置偏移量是相互独立的，每个文件描述符都有各自的文件表，所以位置偏移量是各自维护自己的。
使用多个文件描述符对同一文件进行写操作。
每一个fd都要使用close关闭。

##### 8、文件描述符的复制

文件描述符的复制原理，对fd进行复制，得到fd的副本。

![image-20241105160547354](/home/wqh/Project/Linux/Linux_C/chapter_0/documents/02_文件IO.assets/指向同一个文件表.png)
dup()函数：int dup(int oldfd);	oldfd就是想要复制的文件描述符，函数成功返回newfd，失败返回-1，并设置errno。新的描述符与旧的描述符拥有同样的属性。
dup2()函数：int dup2(int oldfd, int newfd); 	oldfd就是想要复制的文件描述符，此函数允许用户指定newfd，如果指定的newfd被使用了，则会往后寻找下一个没有使用的文件描述符，函数成功返回newfd，失败返回-1，并设置errno。

##### 9、文件共享

什么是文件共享：同一个文件被多个独立的读写体同时进行IO操作。
文件共享的常见实现方式：1、同一进程的多个线程间共享。2、多个不同的进程间实现共享。
文件共享存在竞争冒险。
![image-20241105174851956](/home/wqh/Project/Linux/Linux_C/chapter_0/documents/02_文件IO.assets/不同进程open打开同一文件数据结构关系图.png)
![image-20241105175218434](/home/wqh/Project/Linux/Linux_C/chapter_0/documents/02_文件IO.assets/同一进程多次open打开同一文件各数据结构关系图.png)

##### 10、原子操作与竞争冒险

![image-20241105203850011](/home/wqh/Project/Linux/Linux_C/chapter_0/documents/02_文件IO.assets/AB进程工作流程.png)
上面所描述的情形就是竞争状态（也称为竞争冒险)，操作共享资源的两个进程（或线程)，其操作之后的所得到的结果往往是不可预期的，因为每个进程（或线程)去操作文件的顺序是不可预期的，即这些线程获得CPU使用权的先后顺序是不可预期的，完全由操作系统调配，这就是所谓的竞争状态。

原子操作：就是将上图中lseek和write两个操作步骤合并为一个原子操作，所谓原子操作，是由多步操作组成的一个操作，原子操作要么一步也不执行，一旦执行，必须要执行完所有步骤，不可能只执行所有步骤中的一个子集。原子操作不可被打断。